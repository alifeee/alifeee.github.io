<!DOCTYPE html>
<html>
<head>
<title>Diplomacy</title>
<meta charset="utf-8"/>
<link rel="stylesheet" href="../auxiliary/stylesheet.css">
<style>
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}
th, td {
  padding: 5px;
  text-align: left;
  white-space:nowrap;
}
.graphTable{
  border:none;
}
body{
  max-width:1000px;
  width:1000px
}
</style>
</head>



<body>
<h1><a href="../">alifeee<a></h1>
<h2>Diplomacy Results</h2>

<div>
<table id="results" style="margin-left:auto;margin-right:auto;">
</table>
</div>
<br>

<table class="graphTable" width="100%">
<tr class="graphTable"><td class="graphTable" width="50%"><div style="width:100%">
<canvas id="myChart" width="5" height="190"></canvas>
</div></td>

<td class="graphTable" width="50%"><div style="width:100%">
<canvas id="alexChart" width="5" height="190"></canvas>
</div></td></tr>
</table>
</body>



<script src="https://alifeee.github.io/Chart.js"></script>
<script src="diplo_scripts.js"></script>
<script>
var lgreen = "#548235";
var red = "#ffc1c1";
var yellow = "#ffe699";
var green = "#c6e0b4";
var scores = {};
var xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function () {
if (this.readyState == 4 && this.status == 200) {

var games = JSON.parse(this.responseText);

players=verify_players(games, players);
console.log(players);

var tab = "";

var headers = "<tr>";
headers += "<th>Map</th><th>Game</th>";
for (player in players) {
  headers += "<th>"+player+"</th>";
}
headers += "</tr>";
    
var data = "";
for (game of games) {
  data += "<tr>";
  data += "<td><a style='text-decoration:none' href='https://vdiplomacy.com/variants.php?variantID="
      +game['map']['id']+"'>"
      +game['map']['name']+"</a></td>";
  if (game['id'] == 256214) {
    data += "<td style='text-align:center'><a href='https://webdiplomacy.net/board.php?gameID="
        +game['id']+"'><img src='https://alifeee.github.io/diplomacy/vdip.png'></img></a></td>";
  }
  else {
    data += "<td style='text-align:center'><a href='https://vdiplomacy.com/board.php?gameID="
        +game['id']+"'><img src='https://alifeee.github.io/diplomacy/vdip.png'></img></a></td>";
  }
  for (player in players) {
    var color = ""
    switch(game['results'][player]) {
      case "win": color = lgreen; break;
      case "death": color = red; break;
      case "survive": color = yellow; break;
      case "draw": color = green; break;
      default: color = "blue";
    }
    if (game['results'][player] == undefined) {
      data += "<td>-</td>";
      continue;
    }
    data += "<td style='background-color:"+color+";color:black'>"
        +game['results'][player]+"</td>";
  }
  data += "</tr>";
}

var performance = "<tr>";
performance += "<td title='10, 5, and 1 points for a win, draw, and survive, divided by total number of games'>Performance</td>";
performance += "<td>-</td>";
for (player in players) {
  var score = 0;
  score += players[player]['results']['wins'] * 10;
  score += players[player]['results']['draws'] * 5;
  score += players[player]['results']['survives'] * 1;
  score = score / (players[player]['results']['wins'] 
      + players[player]['results']['draws'] 
      + players[player]['results']['survives'] 
      + players[player]['results']['deaths']);
  score = score.toFixed(2);
  scores[player] = score;
  performance += "<td>"+score+"</td>";
}

var alex_performance = "<tr><td>Alex's Performance</td><td>-</td>";
var alex_scores = {};
for (player in players) {
  alex_scores[player] = 0;
}
for (game of games) {
  var localScore = {};
  var result = game["results"];
  draws = 0;
  victory = Object.keys(result).length;
  for (player in result) {
    switch(result[player]) {
      case "death": localScore[player]=0;break;
      case "survive": localScore[player]=1;break;
      case "win": localScore[player]=victory;break;
      case "draw": draws+=1;break;
      default: console.log("Error in Alex Performance");
    }
  }
  for (player in result) {
    if (result[player]=="draw") {
      localScore[player] = victory/draws;
    }
  }
  for (player in alex_scores) {
    if (typeof localScore[player]=="number") {
      alex_scores[player] = alex_scores[player] + localScore[player];
    }
  }
}
for (player in players) {
  alex_performance += "<td>"+alex_scores[player].toFixed(2)+"</td>";
}

  

  tab += headers;
  tab += data;
  tab += performance;
  tab += alex_performance;
  var table = document.getElementById("results");
  table.innerHTML = tab;



var labs = [];
var dats = [];
for (player in scores) {
  labs.push(player);
  dats.push(scores[player]);
}
var ctx = document.getElementById('myChart').getContext('2d');
Chart.defaults.global.defaultFontColor = '#888';
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: labs,
        datasets: [{
            label: 'Performance',
            data: dats,
            borderWidth: 1,
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)'
        }]
    },
    options: {
        responsiveness: true,
        maintainAspectRatio: false,
        legend: {
          display:false
        },
        scales: {
            yAxes: [{
              scaleLabel: {
                beginAtZero: true,
                display:true,
                labelString: 'Performance'
              }
            }]
        }
    }
});

var alex_dats = [];
for (player in alex_scores) {
  alex_dats.push(alex_scores[player].toFixed(2));
}
var alex_ctx = document.getElementById('alexChart').getContext('2d');
var alex_myChart = new Chart(alex_ctx, {
    type: 'bar',
    data: {
        labels: labs,
        datasets: [{
            label: 'Alex\'s Performance',
            data: alex_dats,
            borderWidth: 1,
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)'
        }]
    },
    options: {
        responsiveness: true,
        maintainAspectRatio: false,
        legend: {
          display:false
        },
        scales: {
            yAxes: [{
              scaleLabel: {
                beginAtZero: true,
                display:true,
                labelString: 'Alex\'s Performance'
              }
            }]
        }
    }
});


  }
};
xmlhttp.open("GET", "https://alifeee.github.io/diplomacy/results.json", true);
xmlhttp.send()
</script>
</body>
</html> 













